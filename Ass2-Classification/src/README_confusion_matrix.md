# ğŸ¯ Confusion Matrix åˆ†æå·¥å…·ä½¿ç”¨èªªæ˜

## ğŸ“‹ åŠŸèƒ½ä»‹ç´¹

é€™å€‹å·¥å…·å¯ä»¥è¼‰å…¥æ‚¨è¨“ç·´å¥½çš„ `.pth` æ¨¡å‹æª”æ¡ˆï¼Œä¸¦é€²è¡Œä»¥ä¸‹åˆ†æï¼š

### âœ… æä¾›çš„åˆ†æåŠŸèƒ½
1. **ğŸ“Š Confusion Matrix** - é¡¯ç¤ºåˆ†é¡éŒ¯èª¤çš„è©³ç´°æƒ…æ³
2. **ğŸ“ˆ æ¨™æº–åŒ– Confusion Matrix** - ç™¾åˆ†æ¯”å½¢å¼çš„æ··æ·†çŸ©é™£
3. **ğŸ“‹ åˆ†é¡å ±å‘Š** - æ¯å€‹é¡åˆ¥çš„ Precision, Recall, F1-score
4. **ğŸ¯ æ¯é¡åˆ¥æº–ç¢ºç‡** - å„é¡åˆ¥çš„æº–ç¢ºç‡æ’åå’Œåˆ†æ
5. **âŒ éŒ¯èª¤æ¨£æœ¬åˆ†æ** - æ‰¾å‡ºåˆ†é¡éŒ¯èª¤çš„å…·é«”æ¨£æœ¬

### ğŸ–¼ï¸ ç”Ÿæˆçš„åœ–è¡¨
- `[model_name]_confusion_matrix.png` - åŸå§‹æ··æ·†çŸ©é™£
- `[model_name]_confusion_matrix_normalized.png` - æ¨™æº–åŒ–æ··æ·†çŸ©é™£
- `[model_name]_per_class_accuracy.png` - å„é¡åˆ¥æº–ç¢ºç‡åœ–è¡¨

### ğŸ“Š ç”Ÿæˆçš„å ±å‘Š
- `[model_name]_classification_report.csv` - è©³ç´°åˆ†é¡å ±å‘Š
- `[model_name]_per_class_accuracy.csv` - å„é¡åˆ¥æº–ç¢ºç‡æ•¸æ“š

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: ç›´æ¥é‹è¡Œ (æ¨è–¦)
```bash
cd e:\NYCU\NYCU_IAII_ML2025\Ass2-Classification\src
python model_confusion_matrix_analyzer.py
```

### æ–¹æ³• 2: åœ¨ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨
```python
from model_confusion_matrix_analyzer import ModelAnalyzer

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = ModelAnalyzer("your_model.pth")

# è¼‰å…¥æ¸¬è©¦è³‡æ–™
dataloader, dataset = analyzer.load_test_data("path/to/test/data")

# é€²è¡Œé æ¸¬
y_true, y_pred, y_probs = analyzer.predict(dataloader)

# ç¹ªè£½ Confusion Matrix
cm = analyzer.plot_confusion_matrix(y_true, y_pred)

# ç”Ÿæˆåˆ†é¡å ±å‘Š
report = analyzer.generate_classification_report(y_true, y_pred)
```

## ğŸ“ æª”æ¡ˆéœ€æ±‚

### å¿…éœ€æª”æ¡ˆ
1. **è¨“ç·´å¥½çš„æ¨¡å‹æª”æ¡ˆ** (`.pth`)
   - åŒ…å« `model_state_dict`
   - åŒ…å« `class_to_idx` æ˜ å°„
   - åŒ…å« `model_name` è³‡è¨Š

2. **æ¸¬è©¦è³‡æ–™è³‡æ–™å¤¾** (ImageFolder æ ¼å¼)
   ```
   test_data/
   â”œâ”€â”€ class_1/
   â”‚   â”œâ”€â”€ image1.jpg
   â”‚   â””â”€â”€ image2.jpg
   â”œâ”€â”€ class_2/
   â”‚   â”œâ”€â”€ image1.jpg
   â”‚   â””â”€â”€ image2.jpg
   â””â”€â”€ ...
   ```

### è‡ªå‹•å°‹æ‰¾çš„è·¯å¾‘
ç¨‹å¼æœƒè‡ªå‹•æœå°‹ä»¥ä¸‹ä½ç½®çš„æ¨¡å‹å’Œè³‡æ–™ï¼š

**æ¨¡å‹æª”æ¡ˆ**:
- ç•¶å‰ç›®éŒ„ä¸‹çš„ `*.pth` æª”æ¡ˆ
- æŒ‰ä¿®æ”¹æ™‚é–“æ’åºï¼Œæœ€æ–°çš„å„ªå…ˆ

**æ¸¬è©¦è³‡æ–™**:
- `Dataset/preprocessed/val`
- `Dataset/preprocessed/test`
- Windows å’Œ WSL è·¯å¾‘éƒ½æ”¯æ´

## ğŸ¯ ä½¿ç”¨ç¯„ä¾‹

### å®Œæ•´åˆ†ææµç¨‹
```bash
# 1. é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd e:\NYCU\NYCU_IAII_ML2025\Ass2-Classification\src

# 2. é‹è¡Œåˆ†æå·¥å…·
python model_confusion_matrix_analyzer.py

# 3. æŒ‰ç…§æç¤ºé¸æ“‡ï¼š
#    - é¸æ“‡è¦åˆ†æçš„æ¨¡å‹æª”æ¡ˆ
#    - é¸æ“‡æ¸¬è©¦è³‡æ–™è·¯å¾‘
#    - ç­‰å¾…åˆ†æå®Œæˆ

# 4. æŸ¥çœ‹ç”Ÿæˆçš„çµæœæª”æ¡ˆ
```

### é æœŸè¼¸å‡º
```
ğŸ¯ EfficientNet æ¨¡å‹åˆ†æå·¥å…·
============================================================
ğŸ“Š åŠŸèƒ½: Confusion Matrix, åˆ†é¡å ±å‘Š, éŒ¯èª¤åˆ†æ
============================================================

ğŸ“‚ æ‰¾åˆ° 3 å€‹æ¨¡å‹æª”æ¡ˆ:
  1. efficientnet_b3_epoch_025_acc_98.50.pth (45.2MB, 10/20 14:30)
  2. convnext_tiny_epoch_020_acc_97.80.pth (112.5MB, 10/19 16:45)
  3. efficientnetv2_m_epoch_015_acc_96.20.pth (201.3MB, 10/18 12:15)

è«‹é¸æ“‡æ¨¡å‹æª”æ¡ˆ (1-3): 1
âœ… é¸æ“‡æ¨¡å‹: efficientnet_b3_epoch_025_acc_98.50.pth

ğŸ“ æ‰¾åˆ° 1 å€‹è³‡æ–™è·¯å¾‘:
  1. E:/NYCU/NYCU_IAII_ML2025/Ass2-Classification/Dataset/preprocessed/val

è«‹é¸æ“‡æ¸¬è©¦è³‡æ–™è·¯å¾‘ (1-1): 1
âœ… é¸æ“‡è³‡æ–™: E:/NYCU/NYCU_IAII_ML2025/Ass2-Classification/Dataset/preprocessed/val

ğŸ” æ¨¡å‹åˆ†æå™¨åˆå§‹åŒ–
ğŸ“ æ¨¡å‹æª”æ¡ˆ: efficientnet_b3_epoch_025_acc_98.50.pth
ğŸ–¥ï¸ ä½¿ç”¨è¨­å‚™: cuda
ğŸ“‚ è¼‰å…¥æ¨¡å‹...
âœ… æ¨¡å‹è¼‰å…¥æˆåŠŸï¼
   æ¨¡å‹: efficientnet_b3
   é¡åˆ¥æ•¸: 50
   é©—è­‰æº–ç¢ºç‡: 98.5
   è¨“ç·´è¼ªæ•¸: 25

ğŸ“Š è¼‰å…¥æ¸¬è©¦è³‡æ–™: E:/NYCU/NYCU_IAII_ML2025/Ass2-Classification/Dataset/preprocessed/val
âœ… æ¸¬è©¦è³‡æ–™è¼‰å…¥å®Œæˆ
   ç¸½æ¨£æœ¬æ•¸: 1250
   é¡åˆ¥æ•¸: 50
   Batchæ•¸: 40

ğŸ”® é–‹å§‹é æ¸¬...
   å·²è™•ç†: 320 æ¨£æœ¬
   å·²è™•ç†: 640 æ¨£æœ¬
   å·²è™•ç†: 960 æ¨£æœ¬
   å·²è™•ç†: 1250 æ¨£æœ¬
âœ… é æ¸¬å®Œæˆï¼
   ç¸½æ¨£æœ¬æ•¸: 1250
   æ•´é«”æº–ç¢ºç‡: 0.9840 (98.40%)

ğŸ¯ é–‹å§‹ç”Ÿæˆåˆ†æå ±å‘Š...

ğŸ“Š ç¹ªè£½ Confusion Matrix...
ğŸ’¾ Confusion Matrix å·²ä¿å­˜: efficientnet_b3_confusion_matrix.png

ğŸ“Š ç¹ªè£½æ¨™æº–åŒ– Confusion Matrix...
ğŸ’¾ æ¨™æº–åŒ– Confusion Matrix å·²ä¿å­˜: efficientnet_b3_confusion_matrix_normalized.png

ğŸ“‹ ç”Ÿæˆåˆ†é¡å ±å‘Š...
ğŸ“Š åˆ†é¡å ±å‘Š:
============================================================
                           precision    recall  f1-score   support
abraham_grampa_simpson      0.96      1.00      0.98        25
apu_nahasapeemapetilon      1.00      0.96      0.98        25
bart_simpson               1.00      1.00      1.00        25
...
ğŸ’¾ åˆ†é¡å ±å‘Šå·²ä¿å­˜: efficientnet_b3_classification_report.csv

ğŸ¯ åˆ†ææ¯é¡åˆ¥æº–ç¢ºç‡...
ğŸ† å„é¡åˆ¥æº–ç¢ºç‡æ’å:
============================================================
homer_simpson        | æº–ç¢ºç‡: 1.0000 (100.00%) | æ­£ç¢º/ç¸½æ•¸: 25/25
lisa_simpson         | æº–ç¢ºç‡: 1.0000 (100.00%) | æ­£ç¢º/ç¸½æ•¸: 25/25
bart_simpson         | æº–ç¢ºç‡: 1.0000 (100.00%) | æ­£ç¢º/ç¸½æ•¸: 25/25
...

âŒ æº–ç¢ºç‡æœ€ä½çš„é¡åˆ¥:
------------------------------------------------------------
milhouse_van_houten | æº–ç¢ºç‡: 0.9200 (92.00%) | éŒ¯èª¤æ•¸: 2
nelson_muntz         | æº–ç¢ºç‡: 0.9600 (96.00%) | éŒ¯èª¤æ•¸: 1
...
ğŸ’¾ æ¯é¡åˆ¥æº–ç¢ºç‡å·²ä¿å­˜: efficientnet_b3_per_class_accuracy.png, efficientnet_b3_per_class_accuracy.csv

ğŸ” åˆ†æåˆ†é¡éŒ¯èª¤çš„æ¨£æœ¬...
ğŸ“Š éŒ¯èª¤åˆ†é¡çµ±è¨ˆ:
   ç¸½æ¨£æœ¬æ•¸: 1250
   éŒ¯èª¤æ¨£æœ¬æ•¸: 20
   éŒ¯èª¤ç‡: 1.60%

âŒ milhouse_van_houten çš„éŒ¯èª¤åˆ†é¡:
   æ¨£æœ¬ 145: milhouse_van_houten â†’ bart_simpson (ä¿¡å¿ƒåº¦: 0.892)
   æ¨£æœ¬ 892: milhouse_van_houten â†’ lisa_simpson (ä¿¡å¿ƒåº¦: 0.756)

ğŸ‰ åˆ†æå®Œæˆï¼
ğŸ“ æ‰€æœ‰çµæœå·²ä¿å­˜åˆ°ç•¶å‰ç›®éŒ„
ğŸ“Š ç¸½é«”æº–ç¢ºç‡: 0.9840
```

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. è§£è®€ Confusion Matrix
- **å°è§’ç·š** = æ­£ç¢ºåˆ†é¡çš„æ•¸é‡
- **éå°è§’ç·š** = åˆ†é¡éŒ¯èª¤
- **é¡è‰²æ·±æ·º** = æ•¸é‡å¤šå¯¡

### 2. é—œæ³¨é‡é»
- **æº–ç¢ºç‡æœ€ä½çš„é¡åˆ¥** - éœ€è¦æ›´å¤šè¨“ç·´è³‡æ–™æˆ–ç‰¹å¾µå·¥ç¨‹
- **ç¶“å¸¸æ··æ·†çš„é¡åˆ¥å°** - å¯èƒ½éœ€è¦æ›´ç´°ç·»çš„ç‰¹å¾µå€åˆ†
- **é«˜ä¿¡å¿ƒåº¦çš„éŒ¯èª¤** - å€¼å¾—æ·±å…¥åˆ†æçš„æ¡ˆä¾‹

### 3. æ”¹é€²å»ºè­°
- æº–ç¢ºç‡ < 95% çš„é¡åˆ¥è€ƒæ…®å¢åŠ è¨“ç·´è³‡æ–™
- æ··æ·†çš„é¡åˆ¥å°è€ƒæ…®ä½¿ç”¨æ›´å¼·çš„è³‡æ–™å¢å¼·
- æ•´é«”æº–ç¢ºç‡ < 90% å»ºè­°ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹æˆ–æ›´å¤šæ­£å‰‡åŒ–

## â“ å¸¸è¦‹å•é¡Œ

### Q: ç¨‹å¼æ‰¾ä¸åˆ°æ¨¡å‹æª”æ¡ˆï¼Ÿ
A: ç¢ºèª `.pth` æª”æ¡ˆåœ¨ç•¶å‰ç›®éŒ„ï¼Œä¸”æª”æ¡ˆåŒ…å«å¿…è¦çš„éµå€¼

### Q: æ¸¬è©¦è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Ÿ
A: ç¢ºèªä½¿ç”¨ ImageFolder æ ¼å¼ï¼Œæ¯å€‹é¡åˆ¥ä¸€å€‹è³‡æ–™å¤¾

### Q: è¨˜æ†¶é«”ä¸è¶³ï¼Ÿ
A: æ¸›å°‘ batch_size æˆ–ä½¿ç”¨ CPU æ¨¡å¼

### Q: é¡åˆ¥æ˜ å°„ä¸åŒ¹é…ï¼Ÿ
A: ç¢ºèªæ¸¬è©¦è³‡æ–™çš„é¡åˆ¥èˆ‡è¨“ç·´æ™‚ä¸€è‡´